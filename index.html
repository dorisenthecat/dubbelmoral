<!DOCTYPE html>
<html>
<head>
  <title>Dubbelmoral!</title>
  <script src="./libs/yabble.js"></script>
  <script src="./libs/gamejs-wrapped.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script>
    require.setModuleRoot('./src/');
    require.run('dubbelmoral')
    
    var windowMoveOffset = [0, 0];
    var windowMoveState = "NOT_MOVING";
    var movingWindow = "";
        
    function activateWindow(windowName) {
      //Deacivate all windows
      $(".window-frame").css("background-image", "none");
      
      //Activate current window
      $("#"+ windowName +"-window .window-frame").css("background-image", "url('images/window-frame.png')");
    }
    
    function stopDragWindow() {
      if(windowMoveState == "MOVING") {
        $("#"+ movingWindow +"-window").offset($(".moving-window-placeholder").offset());
        $(".moving-window-placeholder").remove();
        windowMoveState = "NOT_MOVING";
        activateWindow(movingWindow);
      }
    }
    
    function startDragWindow(windowName, e) {
      $(".moving-window-placeholder").remove();
      $("body").append("<div class='moving-window-placeholder'></div>");
      $(".moving-window-placeholder").offset($("#"+ windowName +"-window").offset());
      $(".moving-window-placeholder").width($("#"+ windowName +"-window").width());
      $(".moving-window-placeholder").height($("#"+ windowName +"-window").height());
      
      movingWindow = windowName;
      windowMoveOffset = [e.clientX - $("#"+ windowName +"-window").offset().left, e.clientY - $("#"+ windowName +"-window").offset().top];
      windowMoveState = "MOVING";
    }
    
    function dragWindow(e) {
      if(windowMoveState == "MOVING") {
        $(".moving-window-placeholder").offset({
          "left": e.clientX - windowMoveOffset[0],
          "top": e.clientY - windowMoveOffset[1]
        });
      }
    }
    
    $(function(){
      $(".window").height($("canvas", $(this)).height + 10);
    });
  </script>
  
  <style>
    *
    {
      user-select: none;
      -moz-user-select: none;
      -khtml-user-select: none;
      -webkit-user-select: none;
    }
    
    BODY 
    {
        background-image: url("images/desktop.png");
        margin: 0px;
        padding: 0px;
    }
    
    #menu 
    {
        font-family: sans-serif;
        font-weight: bold;
        background-color: white;
        height: 20px;
        padding: 0px;
        margin-bottom: 5px;
        border-bottom: 1px solid black;
    }
    
    .window 
    {
      display: inline-block;
      background-color: white;
      border: 1px solid black;
    }
    
    .window canvas {
      padding: 0px;
      margin: 0px;
    }
    
    .window-frame 
    {
      background-color: white;
      height: 7px;
      background-color: white;
      border-bottom: 1px solid black;
      padding-left: 1px;
      padding-right: 1px;
      background-clip:content-box;
    }
    
    .moving-window-placeholder 
    {
      border: 2px solid black;
      position: absolute;
    }
    
    .menu-item 
    {
        margin: 0px;
        display: inline-block;
        font-size: 12px;
        padding: 4px 10px 2px; 10px;
    }
    
    .menu-item:hover {
        cursor: pointer;
        background-color: black;
        color: white;
    }
  </style>
  
</head>
<!-- Html -->
<body onmouseup="stopDragWindow()" onmousemove="dragWindow(event);">
    <div id="menu">
        <span class="menu-item">
            <img src="images/apple.png">
        </span><span class="menu-item">
            Arkiv
        </span><span class="menu-item">
            Redigera
        </span><span class="menu-item">
            Special
        </span>
    </div>
    
    <div>
      <div id="gjs-loader">
           Loading...
      </div>
             
      <div class="window" style="height: 307px" id="map-window" onclick="activateWindow('map');" draggable="false">
        <div onmousedown="startDragWindow('map', event);"  class="window-frame"></div>
        <canvas id="map" draggable="false"></canvas>
      </div>
      
      <div class="window" style="height: 193px" id="main-window" onclick="activateWindow('main');" draggable="false">
        <div onmousedown="startDragWindow('main', event);" class="window-frame"></div>
        <canvas id="gjs-canvas"  draggable="false"></canvas></div>
      
      <div class="window" style="height: 72px" id="hemma-window" onclick="activateWindow('hemma');" draggable="false">
        <div onmousedown="startDragWindow('hemma', event);" class="window-frame"></div>
        <canvas id="hemma" draggable="false"></canvas>
      </div>
    </div>
</body>
</html>
